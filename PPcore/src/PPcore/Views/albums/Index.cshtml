<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12" style="padding-top:15px;">
            <table><tr><td><h4 class="txt-color-blue">ภาพกิจกรรม</h4></td></tr></table>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-blue">
                <!-- .panel-heading -->
                <div class="panel-heading">
                    <div class="pull-left" style="padding-top:5px;">ภาพกิจกรรม</div>
                    <div id="albumTopBarMenu" class="pull-right" style="margin-top:-2px;"></div>
                </div>
                <!-- /.panel-heading -->


                <div id="albumRenderBody" class="panel-body">

                </div>
                <!-- /.panel-body -->
            </div>

            <!-- /.panel -->
        </div>
        <!-- /.col-lg-8 -->

        <!-- Modal Delete -->
        <div class="modal fade modalForm1" id="albumDeleteModal" tabindex="-1" role="dialog" aria-labelledby="albumModalLabel" aria-hidden="true" >
            <div class="modal-dialog">
                <div class="modal-content">
                    <div id="albumModalHeader" class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="vertical-align:middle;top:15px">&times;</button>
                        <h4 class="modal-title" id="albumModalLabel" style="vertical-align:middle;"></h4>
                    </div>
                    <div class="modal-body container-fluid">
                        <div class="row">
                            <div class="col-md-3"><div class="pull-right"> Html.DisplayNameFor(model => model.album_name)</div></div>
                            <div id="albumDeleteName" class="col-md-9" style="color:orangered"></div>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-md-3"><div class="pull-right"> Html.DisplayNameFor(model => model.album_date)</div></div>
                            <div id="albumDeleteDate" class="col-md-9" style="color:orangered"></div>
                        </div>
                        <br/>
                        <br/>
                        <div class="row">
                            <div class="col-md-4"><button id="btnDeleteConfirm" class="btn btn-danger pull-right">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ยืนยัน&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button></div>
                            <div class="col-md-4 col-md-offset-4">
                                <button id="albumDeleteCancel" class="btn btn-default" data-dismiss="modal">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ยกเลิก&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Modal Delete -->



    </div>

</div>


@section Scripts {
    <script src="~/lib/bootstrap/js/modal.js"></script>
<script>
    $(document).ready(function () {
        listAlbum();


    });

    function listAlbum() {
        var topBarMenu = "";
        topBarMenu += '<button id="btnCreate" class="btn btn-default btn-panel-yellow" onclick="albumCreate();">&nbsp;<i class="fa fa-file" aria-hidden="true" style="color:white;"></i>&nbsp;&nbsp;สร้างอัลบั้ม&nbsp;&nbsp;&nbsp;</button> ';
        topBarMenu += '<button id="btnEdit" class="btn btn-default btn-panel-yellow" >&nbsp;<i class="fa fa-pencil-square-o" aria-hidden="true" style="color:white;"></i>&nbsp;&nbsp;แก้ไขอัลบั้ม&nbsp;&nbsp;&nbsp;</button> ';
        topBarMenu += '<button id="btnDelete" class="btn btn-default btn-panel-yellow">&nbsp;<i class="fa fa-eraser" aria-hidden="true" style="color:white;"></i>&nbsp;&nbsp;ลบอัลบั้ม&nbsp;&nbsp;&nbsp;</button> ';
        topBarMenu += '<button id="btnDetails" class="btn btn-default btn-panel-yellow" >&nbsp;<i class="fa fa-file-text" aria-hidden="true" style="color:white;"></i>&nbsp;&nbsp;ดูข้อมูลและแชร์ภาพ</button> ';
        $('#albumTopBarMenu').html(topBarMenu);

        $.ajax({
            type: "GET",
            url: "@Url.Action("ListAlbum", "albums")",
            success: function (data) {
                $('#albumRenderBody').html(data);
                var tableMember = setDataTablesSimple();
                tableMember.$('tr:first').click();


                $('#btnEdit').on('click', function () {
                    var data = tableMember.row('.selected').data();
                    var url = '@Url.Action("Edit", "albums", new { id = "__id__" })';
                    window.location.href = url.replace('__id__', data[1]);
                });

                $('#btnDelete').on('click', function () {
                    var datarow = tableMember.row('.selected').data();
                    $('#albumModalLabel').text('ยืนยันการลบอัลบั้ม');
                    $('#albumDeleteName').text(datarow[0]);
                    $('#albumDeleteDate').text(datarow[3]);
                    $('#albumDeleteModal').modal({ backdrop: 'static', keyboard: false });
                });
                $('#btnDeleteConfirm').on('click', function () {
                    var datarow = tableMember.row('.selected').data();
                    $.ajax({
                        type: "GET",
                        url: "@Url.Action("Delete", "albums")" + "/" + datarow[1],
                        success: function (data) {
                            $('#albumDeleteModal').modal('hide');
                            window.location.href = '@Url.Action("Index", "albums")';
                        },
                        error: function (xhr, textStatus, error) {
                            console.log(xhr.statusText);
                            console.log(textStatus);
                            console.log(error);
                            $('#albumDeleteModal').modal('hide');
                            window.location.href = '@Url.Action("Index", "albums")';
                        }

                    });
                });

                $('#btnDetails').on('click', function () {
                    var data = tableMember.row('.selected').data();
                    var url = '@Url.Action("Details", "albums", new { id = "__id__" })';
                    window.location.href = url.replace('__id__', data[1]);
                });
            },
            error: function (xhr, textStatus, error) {
                console.log(xhr.statusText);
                console.log(textStatus);
                console.log(error);
            }
        });
    }
    function albumCreate() {
        var topBarMenu = "";
        topBarMenu += '<button id="btnBack" class="btn btn-default btn-panel-yellow" onclick="listAlbum();">&nbsp;<i class="fa fa-reply" aria-hidden="true" style="color:white;"></i>&nbsp;&nbsp;กลับ&nbsp;&nbsp;</button>';
        $('#albumTopBarMenu').html(topBarMenu);
        $.ajax({
            type: "GET",
            url: "@Url.Action("Create", "albums")",
            success: function (data) {
                $('#albumRenderBody').html(data);
                $("#album_code").val('@ViewBag.album_code');
                $.datepicker.regional['th'] = {
                    dateFormat: 'dd-mm-yy', changeMonth: true, changeYear: true, constrainInput: true,
                    yearRange: "-100:+0", yearOffSet: 543,
                    beforeShow: function () { if ($("#album_date").val() == "") { $("#album_date").datepicker("setDate", new Date()); } }
                };
                $.datepicker.setDefaults($.datepicker.regional['th']);
                $("#album_date").datepicker($.datepicker.regional["th"]);
                $('#album_dateButton').click(function () {
                    $('#album_date').datepicker("show");
                });

                $('#btnSaveX').on('click', function (e) {
                    e.preventDefault();
                    $.ajax({
                        async:false,
                        type: "POST",
                        url: "@Url.Action("Create", "albums")",
                        data: {
                        album_name: $("#album_name").val(),
                        album_desc: $("#album_desc").val(),
                        album_date: $("#album_date").val(),
                        },
                    success: function (data) {
                        window.location.href = "@Url.Action("Index", "albums")";
                    }
                });
            });




            },
            error: function (xhr, textStatus, error) {
                console.log(xhr.statusText);
                console.log(textStatus);
                console.log(error);
            }
        });
    }
    function albumEdit() {
        $('#btnCreate').on('click', function () {
            var data = tableMember.row('.selected').data();
            $.ajax({
                type: "GET",
                url: "@Url.Action("Create", "albums")" + "/" + data[1],
                success: function (data) {
                    $('#albumDeleteModal').modal('hide');
                    window.location.href = '@Url.Action("Index", "albums")';
                },
            error: function (xhr, textStatus, error) {
                console.log(xhr.statusText);
                console.log(textStatus);
                console.log(error);
            }

        });
    });
    }
</script>

}
